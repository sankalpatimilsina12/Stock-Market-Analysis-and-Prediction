{% load static %}
<!DOCTYPE html>
<html lang="en">

<head>

    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="">
    <meta name="author" content="">

    <title>Stock Market Analysis</title>

    <!-- Bootstrap Core CSS -->
    <link href={% static "css/bootstrap.min.css" %} rel="stylesheet">

    <!-- Custom CSS -->
    <link href={% static "css/small-business.css" %} rel="stylesheet">

    <!-- jQuery -->
    <script type="text/javascript" src={% static 'js/jquery.min.js' %}></script>

    <!-- Bootstrap Core JavaScript -->
    <script type="text/javascript" src={% static 'js/bootstrap.min.js' %}></script>

    <!-- Bootstrap select -->
    <link href={% static "css/bootstrap-select.min.css" %} rel="stylesheet">
    <script src={% static "js/bootstrap-select.min.js" %}></script>

    <script>
    $(function () {
        $('.selectpicker').selectpicker({
            style: 'btn-default',
            });
        });
    });
    </script>

</head>

<style>
    #buttonId {
        margin-right: 17px;
        width: 18%;
    }
    .myClass {
        width: 95%;
    }
    table, th, td {
        text-align: center;
    }
    table {
        width: 100%;
        table-layout: fixed;
    }
</style>


<body>

    <!-- Navigation -->
    <nav class="navbar navbar-inverse navbar-fixed-top" role="navigation">
        <div class="container">
            <!-- Brand and toggle get grouped for better mobile display -->
            <div class="navbar-header">
                <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1">
                    <span class="sr-only">Toggle navigation</span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                </button>
            </div>
            <!-- Collect the nav links, forms, and other content for toggling -->
            <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
                <ul class="nav navbar-nav">
                    <li>
                        <a href="index.html">Home</a>
                    </li>
                    <li>
                        <a href="listed_companies.html">Companies</a>
                    </li>
                    <li>
                        <a href="analysis.html">Analysis</a>
                    </li>
                    <li>
                        <a href="contact.html">About Us</a>
                    </li>
                </ul>
            </div>
            <!-- /.navbar-collapse -->
        </div>
        <!-- /.container -->
    </nav>

    <!-- Page Content -->
    <div class="container">

        <!-- Heading Row -->
        <div class="row">
            <div class="col-md-8">
                <img class="img-responsive img-rounded" src="{% static "images/stock_image.jpg" %}" alt="">
            </div>
            <!-- /.col-md-8 -->
            <div class="col-md-4">
                <h1>Stock Market Analysis</h1>
                <p>Stock Market Analysis and Prediction is the project on technical analysis, visualization and prediction using data proved by NEPSE(Nepal Stock Exchange). The core objective of this project is t comparatively analysie the effectiveness of different prediction algorithms on stock market data and provide general insight on this data to user through visualization.</p>
                <!--<a class="btn btn-primary btn-lg" href="#">Call to Action!</a>-->
            </div>
            <!-- /.col-md-4 -->
        </div>
        <!-- /.row -->
        <hr>

        <div class="row">
            <div class="col-sm-8">
                <div class="myClass">
                    <p style="font-size: 18px; font-style: italic;">Please fill the following:</p>
                    <table class="table">
                        <tbody>
                            <form class="form-horizontal" role="form" method="post">
                                {% csrf_token %}
                                <tr class="success">
                                    <div class="form-group">
                                        <td><label class="col-sm-2 control-label" for="company_stock_name" style="margin-top: 8px">Stock_Name</label>
                                        <div class="col-sm-10">
                                            <select id="selector1" class="selectpicker" title="Eg. Ace Development Bank Limited" data-size="8" data-width="100%" data-dropup-auto="false" data-live-search="true">
                                                {% for i in item_list %}
                                                    <option>{{ i.0 }}</option>
                                                {% endfor %}
                                            </select>
                                        </div>
                                        </td>
                                    </div>
                                </tr>
                                    </div>
                                <tr class="danger">
                                    <div class="form-group">
                                        <td><label class="col-sm-2 control-label" for="features" style="margin-top: 8px">Features(one or more)</label>
                                        <div class="col-sm-10">
                                            <select id="selector2" class="selectpicker" multiple title="Eg. Momentum" data-size="8" data-width="100%" data-live-search="true">
                                                <option>RSI</option>
                                                <option>Momentum</option>
                                                <option>EMA</option>
                                            </select>
                                        </div>
                                        </td>
                                    </div>
                                </tr>
                                <tr class="info">
                                    <div class="form-group">
                                        <td><label class="col-sm-2 control-label" for="features" style="margin-top: 8px">Window_size</label>
                                        <div class="col-sm-10">
                                            <input id="input1" style="width:100%" type="text" placeholder="Eg. 20" class="form-control">
                                        </div>
                                        </td>
                                    </div>
                                </tr>
                                <tr class="success">
                                    <div class="form-group">
                                        <td><label class="col-sm-2 control-label" for="features" style="margin-top: 8px">Proportion</label>
                                        <div class="col-sm-10">
                                            <input id="input2" style="width:100%" type="text" placeholder="Eg. 0.25" class="form-control">
                                        </div>
                                        </td>
                                    </div>
                                </tr>
                                <tr class="danger">
                                    <div class="form-group">
                                        <td><label class="col-sm-2 control-label" for="features" style="margin-top: 8px">nNeurons</label>
                                        <div class="col-sm-10">
                                            <input id="input3" style="width:100%" type="text" placeholder="Eg. 50" class="form-control">
                                        </div>
                                        </td>
                                    </div>
                                </tr>
                                <tr class="info">
                                    <div class="form-group">
                                        <td><label class="col-sm-2 control-label" for="features" style="margin-top: 8px">nHorizon</label>
                                        <div class="col-sm-10">
                                            <input id="input4" style="width:100%" type="text" placeholder="Eg. 1" class="form-control">
                                        </div>
                                        </td>
                                    </div>
                                </tr>
                            </form>
                    <tr class="danger">
                        <td><button id="buttonId" type="submit" class="btn btn-danger pull-right" data-dismiss="modal">Submit</button></td>
                    </tr>
                        </tbody>
                    </table>
                </div>
                <!-- /.myClass -->
            </div>
            <!-- /.col-sm-8 -->
            <div class="col-sm-4">
                <p id="myParagraph1"></p>
                <table id="myTable"></table>
                <p id="myParagraph2"></p>
            </div>
            <!-- /.col-sm-4 -->
        </div>
        <!-- /.myclass -->

        <!-- Footer -->
        <footer>
            <div class="row">
                <div class="col-lg-12">
                    <p>Copyright &copy; Stock Analysis 2016</p>
                </div>
            </div>
        </footer>
    </div>
    <!-- /.container -->

    <script type="text/javascript">
    $('#buttonId').click(function(e) {  //catch the form's submit event
        e.preventDefault();         //prevent page from getting refreshed
        var arr = {{ item|safe }}; //get the returned array in javascript array
        stock_name = $('#selector1').find("option:selected").text();
        for(i = 0; i < arr.length; i++) {
            if(stock_name == arr[i][0]) {
                stock_name = arr[i][1];
                break;
            }
        }

        $.ajax({
            type: 'POST',
            url: '/train',
            data:{ 
                stock_name: stock_name,
                features: $('#selector2').find("option:selected").text(),
                window_size:$('#input1').val(),
                proportion:$('#input2').val(),
                nNeurons:$('#input3').val(),
                nHorizon:$('#input4').val(),
                csrfmiddlewaretoken:$('input[name=csrfmiddlewaretoken]').val()
            },
            success:function(json) {
                var data = $.parseJSON(json);

                var paragraphData1 = '<p style="font-style:italic; font-size:18px;">' + 'Analysis Result:' + '</p>';
                var paragraphData2 = '<br><p style="font-style:italic; font-size:15px;">' + '<strong>' + 'Accuracy: ' + '</strong>' + data["Accuracy"] + '</p>';
                paragraphData2 += '<p style="font-style:italic; font-size:15px;">' + '<strong>' + 'Precision: '+ '</strong>' + data["Precision"] + '</p>';
                paragraphData2 += '<p style="font-style:italic; font-size:15px;">' + '<br>' + '<strong>' + 'The result for one day ahead:' + '</strong>' + '</p>';
                paragraphData2 += '<p style="font-style:italic; font-size:15px;">' + '[' + data['next'] + ']' + '<strong>' + ' ' + '<br><br>' + 'Trend: ' + '</strong>' + data['trend'] + '</p>';
                var tableData = '<table>';
                tableData += '<thead>';
                tableData += '<tr>';
                tableData += '<th>' + 'Index' + '</th>';
                tableData += '<th>' + 'Precision' + '</th>';
                tableData += '<th>' + 'Recall' + '</th>';
                tableData += '<th>' + 'F1-score' + '</th>';
                tableData += '<th>' + 'Support' + '</th>';
                tableData += '</tr>';
                tableData += '</thead>';
                tableData += '<tbody>';
                tableData += '<tr>';
                tableData += '<td>' + 'UP' + '</td>';
                tableData += '<td>' + data["my_list"][0] + '</td>';
                tableData += '<td>' + data["my_list"][1] + '</td>';
                tableData += '<td>' + data["my_list"][2] + '</td>';
                tableData += '<td>' + data["my_list"][3] + '</td>';
                tableData += '</tr>';
                tableData += '<tr>';
                tableData += '<td>' + 'DOWN' + '</td>';
                tableData += '<td>' + data["my_list"][4] + '</td>';
                tableData += '<td>' + data["my_list"][5] + '</td>';
                tableData += '<td>' + data["my_list"][6] + '</td>';
                tableData += '<td>' + data["my_list"][7] + '</td>';
                tableData += '</tr>';
                tableData += '<tr>';
                tableData += '<td>' + 'AVG/TOTAL' + '</td>';
                tableData += '<td>' + data["my_list"][8] + '</td>';
                tableData += '<td>' + data["my_list"][9] + '</td>';
                tableData += '<td>' + data["my_list"][10] + '</td>';
                tableData += '<td>' + data["my_list"][11] + '</td>';
                tableData += '</tr>';
                tableData += '</tbody>';
                tableData += '</table>';
                
                document.getElementById("myParagraph1").innerHTML = paragraphData1;
                document.getElementById("myTable").innerHTML = tableData;
                document.getElementById("myParagraph2").innerHTML = paragraphData2;

            },
            error:function() {
                alert("Please input valid arguments!");
            }
        });
    });
    </script>


</body>

</html>
